<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chat â€” FastAPI + Groq</title>
  <style>
    :root{
      --bg: #f4f7fb;
      --card: #ffffff;
      --muted: #9aa4b2;
      --bot-bg: #eef0f3;
      --user-bg: linear-gradient(135deg,#3b82f6,#2563eb);
      --accent: #2563eb;
      --danger: #ef4444;
      --radius: 14px;
      --max-width: 900px;
      --gap: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      background:linear-gradient(180deg,var(--bg),#edf2f7); color:#17233c;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }

    .wrap{
      width:100%; max-width:var(--max-width);
      background:transparent;
      display:flex; flex-direction:column; gap:18px;
    }

    .chat-card{
      background:var(--card); border-radius:18px; box-shadow:0 6px 30px rgba(24,39,75,0.06);
      overflow:hidden; display:flex; flex-direction:column; height:80vh; min-height:520px;
    }

    header{
      display:flex; align-items:center; gap:12px; padding:18px 20px; border-bottom:1px solid #f0f3f7;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width:44px; height:44px; border-radius:10px; background:var(--accent); display:flex; align-items:center; justify-content:center; color:white; font-weight:700; font-size:18px;
      box-shadow:0 4px 18px rgba(37,99,235,0.18);
    }
    header h1{font-size:16px; margin:0}
    header p{margin:0; font-size:12px; color:var(--muted)}

    .messages{
      flex:1; overflow:auto; padding:20px; display:flex; flex-direction:column; gap:12px; scrollbar-width:thin;
    }

    .message{
      max-width:78%; padding:12px 14px; border-radius:14px; line-height:1.4; position:relative; word-wrap:break-word;
      opacity:0; transform:translateY(8px); transition:all 320ms cubic-bezier(.2,.9,.2,1);
    }
    .message.show{opacity:1; transform:none}

    .bot{ align-self:flex-start; background:var(--bot-bg); color:#18202d; border-bottom-left-radius:6px; }
    .user{ align-self:flex-end; background:var(--user-bg); color:white; border-bottom-right-radius:6px; box-shadow:0 6px 18px rgba(37,99,235,0.12); }

    .meta{display:flex; gap:8px; align-items:center; font-size:12px; color:var(--muted); margin-top:6px}

    .input-area{
      padding:14px; border-top:1px solid #f0f3f7; display:flex; gap:12px; align-items:center; background:linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.75));
    }

    .input{
      flex:1; display:flex; gap:8px; align-items:center; background:rgba(244,247,250,0.9); padding:8px 10px; border-radius:12px; border:1px solid #eef2f7;
    }
    textarea{width:100%; border:0; outline:none; resize:none; background:transparent; font-size:15px; padding:8px; color:inherit}

    .send-btn{
      background:var(--accent); color:white; border:0; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:600; display:inline-flex; align-items:center; gap:8px;
      box-shadow:0 6px 18px rgba(37,99,235,0.16); transition:transform 120ms ease, box-shadow 120ms ease;
    }
    .send-btn:active{transform:translateY(1px)}
    .send-btn[disabled]{opacity:0.6; cursor:default; box-shadow:none}

    .typing-dots{display:inline-flex; gap:6px; align-items:center}
    .typing-dots span{width:6px; height:6px; background:#bcc7d6; border-radius:99px; display:inline-block; animation:dots 1s infinite linear}
    .typing-dots span:nth-child(2){animation-delay:0.12s}
    .typing-dots span:nth-child(3){animation-delay:0.24s}
    @keyframes dots{0%{transform:translateY(0)}50%{transform:translateY(-6px)}100%{transform:translateY(0)}}

    .small{font-size:13px; color:var(--muted)}

    /* Responsive tweaks */
    @media (max-width:600px){
      .chat-card{height:92vh; min-height:420px; border-radius:12px}
      .logo{width:38px;height:38px}
    }

    /* error bubble */
    .error{background:linear-gradient(180deg,#ffecec,#ffd6d6); color:var(--danger); border:1px solid rgba(239,68,68,0.08)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="chat-card" role="application" aria-label="Chat with bot">
      <header>
        <div class="brand">
          <div class="logo">AI</div>
          <div>
            <h1>Groq Chat</h1>
            <p class="small">Connected to <code>http://127.0.0.1:8000/chat</code></p>
          </div>
        </div>
      </header>

      <div class="messages" id="messages" aria-live="polite" aria-atomic="false">
        <!-- messages injected here -->
      </div>

      <div class="input-area">
        <div class="input" role="search">
          <textarea id="input" rows="1" placeholder="Type your message and press Enter" aria-label="Message input"></textarea>
        </div>
        <button id="send" class="send-btn">Send</button>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const endpoint = 'http://127.0.0.1:8000/chat';
      const messagesEl = document.getElementById('messages');
      const inputEl = document.getElementById('input');
      const sendBtn = document.getElementById('send');

      function escapeText(text){
        // avoid HTML injection by creating a text node
        const span = document.createElement('span');
        span.textContent = text;
        return span.innerHTML;
      }

      function appendMessage(text, who='bot', opts={}){
        const wrap = document.createElement('div');
        wrap.className = 'message ' + (who==='user' ? 'user' : 'bot');
        if(opts.error) wrap.classList.add('error');
        // inner content
        const p = document.createElement('div');
        p.className = 'content';
        // set as textContent for safety
        p.textContent = text;
        wrap.appendChild(p);

        // meta row
        const meta = document.createElement('div');
        meta.className = 'meta';
        meta.innerHTML = who==='user' ? '<span class="small">You</span>' : '<span class="small">Bot</span>';
        wrap.appendChild(meta);

        messagesEl.appendChild(wrap);
        // let browser paint, then show animation
        requestAnimationFrame(()=> requestAnimationFrame(()=> wrap.classList.add('show')));
        scrollToBottom();
        return wrap;
      }

      function appendTyping(){
        const wrap = document.createElement('div');
        wrap.className = 'message bot typing';
        const dot = document.createElement('div');
        dot.className = 'typing-dots';
        dot.innerHTML = '<span></span><span></span><span></span>';
        wrap.appendChild(dot);
        messagesEl.appendChild(wrap);
        requestAnimationFrame(()=> requestAnimationFrame(()=> wrap.classList.add('show')));
        scrollToBottom();
        return wrap;
      }

      function replaceTypingWith(wrap, text){
        if(!wrap) return appendMessage(text,'bot');
        wrap.className = 'message bot show';
        wrap.innerHTML = '';
        const p = document.createElement('div'); p.className = 'content'; p.textContent = text;
        wrap.appendChild(p);
        const meta = document.createElement('div'); meta.className = 'meta'; meta.innerHTML = '<span class="small">Bot</span>';
        wrap.appendChild(meta);
        scrollToBottom();
      }

      function scrollToBottom(){
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      async function sendMessage(){
        const text = inputEl.value.trim();
        if(!text) return;
        // append user
        appendMessage(text,'user');
        inputEl.value='';
        inputEl.style.height = '';
        sendBtn.disabled = true;
        inputEl.disabled = true;

        // show typing placeholder
        const typing = appendTyping();

        try{
          const resp = await fetch(endpoint, {
            method: 'POST', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({message:text})
          });
          const data = await resp.json();
          if(resp.ok && data.reply){
            replaceTypingWith(typing, data.reply);
          } else {
            const errMsg = data.error || (data.detail || JSON.stringify(data));
            replaceTypingWith(typing, 'Error: ' + errMsg);
            typing.classList.add('error');
          }
        } catch(err){
          replaceTypingWith(typing, 'Network error: ' + err.message);
          typing.classList.add('error');
        } finally{
          sendBtn.disabled = false;
          inputEl.disabled = false;
          inputEl.focus();
        }
      }

      // Auto-resize textarea
      function autoResize(){
        inputEl.style.height = 'auto';
        inputEl.style.height = Math.min(inputEl.scrollHeight, 160) + 'px';
      }
      inputEl.addEventListener('input', autoResize);

      // Enter to send (Shift+Enter for newline)
      inputEl.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' && !e.shiftKey){
          e.preventDefault(); sendMessage();
        }
      });

      sendBtn.addEventListener('click', sendMessage);

      // initial welcome message
      appendMessage('Hello! I\'m your assistant. Ask me anything.', 'bot');

      // small accessibility: focus input
      inputEl.focus();

      // make sure we scroll when window resizes (mobile keyboards)
      window.addEventListener('resize', scrollToBottom);

      // smooth show of existing message (for welcome)
      setTimeout(scrollToBottom, 50);
    })();
  </script>
</body>
</html>